<div [class]="getSearchClass()">
  <!-- Search Bar -->
  <div class="search-bar">
    <div class="search-input-container">
      <input 
        type="text" 
        pInputText 
        [(ngModel)]="searchText"
        (input)="onSearchTextChange()"
        [placeholder]="placeholder"
        class="search-input">
      
      <button 
        *ngIf="clearable && hasActiveFilters()"
        pButton 
        icon="pi pi-times" 
        class="p-button-text p-button-sm clear-button"
        (click)="onClearSearch()"
        pTooltip="Limpar busca">
      </button>
    </div>

    <button 
      *ngIf="fields.length > 0"
      pButton 
      [icon]="isAdvancedOpen ? 'pi pi-chevron-up' : 'pi pi-chevron-down'"
      [label]="isAdvancedOpen ? 'Fechar' : 'Filtros'"
      class="p-button-outlined p-button-sm advanced-toggle"
      (click)="onToggleAdvanced()"
      [pTooltip]="isAdvancedOpen ? 'Fechar filtros avançados' : 'Abrir filtros avançados'">
      
      <span *ngIf="!isAdvancedOpen && getActiveFiltersCount() > 0" 
            class="filter-badge">{{ getActiveFiltersCount() }}</span>
    </button>
  </div>

  <!-- Advanced Filters -->
  <div class="advanced-filters" *ngIf="isAdvancedOpen && fields.length > 0">
    <p-card styleClass="filters-card">
      <div class="filters-content">
        <div class="filters-grid">
          <div 
            *ngFor="let field of fields" 
            [class]="getFieldClass(field)"
            class="filter-item">
            
            <!-- Text Input -->
            <div *ngIf="field.type === 'text'" class="field-container">
              <label class="field-label">{{ field.label }}</label>
              <input 
                type="text" 
                pInputText 
                [(ngModel)]="searchCriteria[field.key]"
                (ngModelChange)="onCriteriaChange()"
                [placeholder]="field.placeholder || field.label"
                class="field-input">
            </div>

            <!-- Number Input -->
            <div *ngIf="field.type === 'number'" class="field-container">
              <label class="field-label">{{ field.label }}</label>
              <input 
                type="number" 
                pInputText 
                [(ngModel)]="searchCriteria[field.key]"
                (ngModelChange)="onCriteriaChange()"
                [placeholder]="field.placeholder || field.label"
                [min]="field.min"
                [max]="field.max"
                class="field-input">
            </div>

            <!-- Select Dropdown -->
            <div *ngIf="field.type === 'select'" class="field-container">
              <label class="field-label">{{ field.label }}</label>
              <p-dropdown 
                [(ngModel)]="searchCriteria[field.key]"
                (onChange)="onCriteriaChange()"
                [options]="field.options"
                [placeholder]="field.placeholder || 'Selecione...'"
                [showClear]="true"
                class="field-dropdown">
              </p-dropdown>
            </div>

            <!-- Multi Select -->
            <div *ngIf="field.type === 'multiselect'" class="field-container">
              <label class="field-label">{{ field.label }}</label>
              <p-multiSelect 
                [(ngModel)]="searchCriteria[field.key]"
                (onChange)="onCriteriaChange()"
                [options]="field.options"
                [placeholder]="field.placeholder || 'Selecione...'"
                [showClear]="true"
                class="field-multiselect">
              </p-multiSelect>
            </div>

            <!-- Date Picker -->
            <div *ngIf="field.type === 'date'" class="field-container">
              <label class="field-label">{{ field.label }}</label>
              <p-calendar 
                [(ngModel)]="searchCriteria[field.key]"
                (onSelect)="onCriteriaChange()"
                [placeholder]="field.placeholder || 'Selecione a data'"
                [showClear]="true"
                dateFormat="dd/mm/yy"
                class="field-calendar">
              </p-calendar>
            </div>

            <!-- Date Range Picker -->
            <div *ngIf="field.type === 'daterange'" class="field-container">
              <label class="field-label">{{ field.label }}</label>
              <p-calendar 
                [(ngModel)]="searchCriteria[field.key]"
                (onSelect)="onCriteriaChange()"
                [placeholder]="field.placeholder || 'Selecione o período'"
                [showClear]="true"
                [selectionMode]="'range'"
                dateFormat="dd/mm/yy"
                class="field-calendar">
              </p-calendar>
            </div>
          </div>
        </div>

        <!-- Filter Actions -->
        <div class="filter-actions">
          <button 
            pButton 
            label="Aplicar Filtros" 
            icon="pi pi-filter"
            class="p-button-sm apply-button"
            (click)="performSearch()">
          </button>
          
          <button 
            pButton 
            label="Limpar Filtros" 
            icon="pi pi-times"
            class="p-button-outlined p-button-sm clear-filters-button"
            (click)="onClearSearch()">
          </button>
        </div>
      </div>
    </p-card>
  </div>
</div>

